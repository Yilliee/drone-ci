From f1d7c33ca32b5a69e36ade3a592769f3c7196df5 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Yilli=C3=A9?= <yilliee@protonmail.com>
Date: Tue, 24 May 2022 14:46:05 +0500
Subject: [PATCH 3/4] FoxExtras : fox_list_apps : Add support for A11/12's
 encrypted /data/app folder

---
 FoxExtras/sbin/fox_list_apps | 24 +++++++++++++-----------
 orangefox_build_vars.txt     |  3 +--
 2 files changed, 14 insertions(+), 13 deletions(-)

diff --git a/FoxExtras/sbin/fox_list_apps b/FoxExtras/sbin/fox_list_apps
index 91b9d95..4fa72c6 100755
--- a/FoxExtras/sbin/fox_list_apps
+++ b/FoxExtras/sbin/fox_list_apps
@@ -30,25 +30,27 @@ local apps_dir="/data/app"
 local namestr="application-label:'"
 local d_mnt=$(is_mounted "/data")
 
-	[ -d "$list" ] && return	
+	[ -d "$list" ] && return
 	[ "$d_mnt" != "1" ] && mount /data
-	
+
 	mkdir -p "$tmp" "$list"
-	cd "$apps_dir"
+
+
 	if [ -f "/sbin/aapt" ]; then
-	   for pkgname in * ; do
-	       name=$(aapt dump badging "$pkgname/base.apk" 2>/dev/null | grep "$namestr" | sed "s/"$namestr"//" | sed "s/'//")
+	   for pkgname in $(ls /data/app/* | cut -d':' -f2 | cut -d'-' -f1 | sed "/^$/d" ) ; do
+	       fullpath=$(ls /data/app/*/* | grep $pkgname | cut -d':' -f1)
+	       name=$(aapt dump badging "$fullpath/base.apk" | grep "$namestr" | sed "s/"$namestr"//" | sed "s/'//" | sed "s/'//")
 	       if [ -n "$name" ]; then
-	          echo "$apps_dir/$pkgname" > "$list/$name"
+		  echo "$fullpath" > "$list/$name"
 	       fi
 	   done
-	else 
-	   for pkgname in * ; do
-	      name="$(echo "$pkgname" | sed 's+-.*++g')"
-	      echo "$apps_dir/$pkgname" > "$list/$name"
+	else
+	   for pkgname in $(ls /data/app/* | cut -d':' -f2 | cut -d'-' -f1 | sed "/^$/d" ) ; do
+		fullpath=$(ls /data/app/*/* | grep $pkgname | cut -d':' -f1)
+		echo "$fullpath" > "$list/$pkgname"
 	   done
 	fi
-	
+
 	exit 0
 }
 
diff --git a/orangefox_build_vars.txt b/orangefox_build_vars.txt
index 964a3e3..1b3c2e1 100644
--- a/orangefox_build_vars.txt
+++ b/orangefox_build_vars.txt
@@ -510,8 +510,7 @@ OF_MAINTAINER_AVATAR" [NEW]
 - default = 0
 #
 "FOX_ENABLE_APP_MANAGER" [NEW]
-- set this to 1 to enable the OrangeFox App Manager (now disabled by default)
-- sometimes there are issues with the App Manager, especially with Android 11 - if you don't care, then use this variable to enable it
+- set this to 1 to enable the OrangeFox's App Manager (now disabled by default)
 - default = 0
 #
 "FOX_USE_GREP_BINARY" [NEW]
-- 
2.35.1

